```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - CasaBella</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm border-bottom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main.index') }}">
                <i class="bi bi-arrow-left me-2"></i>
                <img src="{{ url_for('static', filename='images/casa-bella-logo-dark.jpeg') }}" alt="CasaBella" class="rounded-circle me-2" width="48" height="48">
            </a>
            <h1 class="navbar-text fs-4 fw-bold mb-0">Mi Perfil</h1>
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-secondary me-2" id="themeToggle">
                    <i class="bi bi-sun"></i>
                </button>
                <div class="dropdown">
                    <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i class="bi bi-box-arrow-in-right me-2"></i>Cerrar Sesión</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="row g-4">
            <!-- Profile Sidebar -->
            <div class="col-lg-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="profile-avatar bg-primary text-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                            {{ user.nombre[0:2]|upper }}
                        </div>
                        <h5 class="card-title">{{ user.nombre }}</h5>
                        <p class="card-text text-muted">{{ user.email }}</p>
                        <span class="badge bg-success">{{ user.rol }}</span>
                    </div>
                    <div class="card-body border-top">
                        <div class="d-flex align-items-center mb-3">
                            <i class="bi bi-telephone text-primary me-2"></i>
                            <small>{{ user.telefono or 'No especificado' }}</small>
                        </div>
                        <div class="d-flex align-items-center mb-3">
                            <i class="bi bi-calendar text-primary me-2"></i>
                            <small>Miembro desde {{ user.fecha_registro.strftime('%d %b %Y') }}</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="bi bi-geo-alt text-primary me-2"></i>
                            <small>Guavatá, Colombia</small>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0">Estadísticas</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <small class="text-muted">Citas Totales</small>
                            <strong>{{ citas|length }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <small class="text-muted">Compras</small>
                            <strong>{{ ventas|length }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <small class="text-muted">Reseñas</small>
                            <strong>{{ reseñas|length }}</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">Calificación Promedio</small>
                            <div class="d-flex align-items-center">
                                {% set avg_rating = reseñas|map(attribute='calificacion')|sum / (reseñas|length or 1) %}
                                {% for i in range(5) %}
                                    <i class="bi bi-star-fill text-warning" style="margin-right: 2px;"></i>
                                {% endfor %}
                                <strong>{{ '%.1f'|format(avg_rating) }}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Navigation Tabs -->
                <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab">
                            <i class="bi bi-person me-1"></i>Información
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="citas-tab" data-bs-toggle="tab" data-bs-target="#citas" type="button" role="tab">
                            <i class="bi bi-calendar me-1"></i>Citas
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="compras-tab" data-bs-toggle="tab" data-bs-target="#compras" type="button" role="tab">
                            <i class="bi bi-bag me-1"></i>Compras
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reseñas-tab" data-bs-toggle="tab" data-bs-target="#reseñas" type="button" role="tab">
                            <i class="bi bi-star me-1"></i>Reseñas
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="notificaciones-tab" data-bs-toggle="tab" data-bs-target="#notificaciones" type="button" role="tab">
                            <i class="bi bi-bell me-1"></i>Notificaciones
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content mt-3" id="profileTabsContent">
                    <!-- Información Personal -->
                    <div class="tab-pane fade show active" id="info" role="tabpanel">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">Información Personal</h5>
                                    <small class="text-muted">Gestiona tu información de perfil</small>
                                </div>
                                <button class="btn btn-outline-primary" id="editProfileBtn">
                                    <i class="bi bi-pencil me-1"></i>Editar
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="row" id="profileView">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center mb-3">
                                            <i class="bi bi-person text-primary me-3"></i>
                                            <div>
                                                <small class="text-muted">Nombre</small>
                                                <p class="mb-0 fw-medium">{{ user.nombre }}</p>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center mb-3">
                                            <i class="bi bi-envelope text-primary me-3"></i>
                                            <div>
                                                <small class="text-muted">Email</small>
                                                <p class="mb-0 fw-medium">{{ user.email }}</p>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center mb-3">
                                            <i class="bi bi-telephone text-primary me-3"></i>
                                            <div>
                                                <small class="text-muted">Teléfono</small>
                                                <p class="mb-0 fw-medium">{{ user.telefono or 'No especificado' }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center mb-3">
                                            <i class="bi bi-calendar text-primary me-3"></i>
                                            <div>
                                                <small class="text-muted">Fecha de Registro</small>
                                                <p class="mb-0 fw-medium">{{ user.fecha_registro.strftime('%d de %B de %Y') }}</p>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center mb-3">
                                            <i class="bi bi-person-badge text-primary me-3"></i>
                                            <div>
                                                <small class="text-muted">Rol</small>
                                                <div class="mt-1">
                                                    <span class="badge bg-success">{{ user.rol }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Edit Form (Hidden by default) -->
                                <div class="row d-none" id="profileEdit">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Nombre completo</label>
                                            <input type="text" class="form-control" value="{{ user.nombre }}" id="editNombre">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" value="{{ user.email }}" id="editEmail" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Teléfono</label>
                                            <input type="tel" class="form-control" value="{{ user.telefono or '' }}" id="editTelefono">
                                        </div>
                                        <div class="mb-3">
                                            <button class="btn btn-success me-2" id="saveProfileBtn">
                                                <i class="bi bi-check me-1"></i>Guardar
                                            </button>
                                            <button class="btn btn-secondary" id="cancelEditBtn">
                                                <i class="bi bi-x me-1"></i>Cancelar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Historial de Citas -->
                    <div class="tab-pane fade" id="citas" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-1">Historial de Citas</h5>
                                <small class="text-muted">Todas tus citas pasadas y futuras</small>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Servicio</th>
                                                <th>Empleado</th>
                                                <th>Fecha</th>
                                                <th>Hora</th>
                                                <th>Estado</th>
                                                <th>Precio</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for cita in citas %}
                                            <tr>
                                                <td class="fw-medium">{{ cita.servicio.nombre if cita.servicio else 'No especificado' }}</td>
                                                <td>{{ cita.empleado.nombre if cita.empleado else 'Sin asignar' }}</td>
                                                <td>{{ cita.fecha_hora.strftime('%d/%m/%Y') }}</td>
                                                <td>{{ cita.fecha_hora.strftime('%H:%M') }}</td>
                                                <td><span class="badge" style="background-color: {% if cita.estado == 'completada' %}#28a745{% elif cita.estado == 'confirmada' %}#007bff{% else %}#6c757d{% endif %}">{{ cita.estado }}</span></td>
                                                <td>${{ cita.servicio.precio if cita.servicio else '0.00' }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Historial de Compras -->
                    <div class="tab-pane fade" id="compras" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-1">Historial de Compras</h5>
                                <small class="text-muted">Todas tus compras realizadas</small>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    {% for venta in ventas %}
                                    <div class="col-12">
                                        <div class="card border">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0">Compra #{{ loop.index }}</h6>
                                                <span class="badge bg-success">Completado</span>
                                            </div>
                                            <div class="card-body">
                                                <div class="d-flex align-items-center text-muted mb-2">
                                                    <i class="bi bi-calendar me-1"></i>
                                                    <small class="me-3">{{ venta.fecha_venta.strftime('%d/%m/%Y') }}</small>
                                                    <i class="bi bi-credit-card me-1"></i>
                                                    <small>{{ venta.metodo_pago or 'No especificado' }}</small>
                                                </div>
                                                <div class="mb-2">
                                                    {% for detalle in venta.detalle_ventas %}
                                                    <div class="d-flex justify-content-between">
                                                        <small>{{ detalle.producto.nombre }} x{{ detalle.cantidad }}</small>
                                                        <small class="fw-medium">${{ '%.2f'|format(detalle.cantidad * detalle.producto.precio) }}</small>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                                <div class="border-top pt-2 d-flex justify-content-between fw-bold">
                                                    <span>Total:</span>
                                                    <span class="text-primary">${{ '%.2f'|format(venta.total) }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reseñas -->
                    <div class="tab-pane fade" id="reseñas" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-1">Mis Reseñas</h5>
                                <small class="text-muted">Reseñas que has dejado sobre nuestros servicios</small>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    {% for reseña in reseñas %}
                                    <div class="col-12">
                                        <div class="card border">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <div>
                                                        <h6 class="mb-1">{{ reseña.cita.servicio.nombre if reseña.cita and reseña.cita.servicio else 'Servicio no especificado' }}</h6>
                                                        <div class="d-flex align-items-center">
                                                            {% for i in range(5) %}
                                                                <i class="bi bi-star-fill text-warning" style="margin-right: 2px;"></i>
                                                            {% endfor %}
                                                            <small class="text-muted ms-2">{{ reseña.calificacion }}/5 estrellas</small>
                                                        </div>
                                                    </div>
                                                    <small class="text-muted">{{ reseña.fecha_resena.strftime('%d/%m/%Y') }}</small>
                                                </div>
                                                <p class="text-muted mb-0">{{ reseña.comentario or 'Sin comentario' }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notificaciones -->
                    <div class="tab-pane fade" id="notificaciones" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-1">Notificaciones</h5>
                                <small class="text-muted">Tus notificaciones recientes</small>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    {% for notificacion in notificaciones %}
                                    <div class="col-12">
                                        <div class="alert alert-{% if notificacion.tipo == 'cita' %}primary{% elif notificacion.tipo == 'promocion' %}info{% else %}success{% endif %} d-flex align-items-start">
                                            <i class="bi bi-bell me-2 mt-1"></i>
                                            <div class="flex-grow-1">
                                                <p class="mb-1">{{ notificacion.mensaje }}</p>
                                                <div class="d-flex align-items-center">
                                                    <span class="badge bg-{% if notificacion.tipo == 'cita' %}primary{% elif notificacion.tipo == 'promocion' %}info{% else %}success{% endif %} me-2">{{ notificacion.tipo }}</span>
                                                    <small class="text-muted">
                                                        <i class="bi bi-clock me-1"></i>{{ notificacion.fecha.strftime('%d/%m/%Y') }}
                                                    </small>
                                                </div>
                                            </div>
                                            <div class="notification-dot bg-{% if notificacion.tipo == 'cita' %}primary{% elif notificacion.tipo == 'promocion' %}info{% else %}success{% endif %}"></div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
```